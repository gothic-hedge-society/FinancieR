# context("Accuracy")
# 
# library(magrittr)
# library(xts)
# 
# # Do a few checks on returns that were calculated by spreadsheet.
# 
# test_that(
#   paste0(
#     "calculate_daily_returns() correctly handles Texas Instruments' Hurricane ",
#     "Sandy missing dividend for all returns_method options."
#   ),
#   expect_identical(
#     round(
#       zoo::coredata(
#         calculate_daily_returns(
#           sample_historical_data["TXN"],
#           date_range_xts = "2012-10-31"
#         )[[1]]
#       ),
#       digits = 5
#     ),
#     round(
#       cbind(
#         "ln_rtn"    = -2.1671592641372,
#         "log2_rtn"  = -3.12654992318732,
#         "log10_rtn" = -0.941185309820299,
#         "pct_diff"  = -2.14384508990318,
#         "multiple"  =  0.978561549100968
#       ),
#       digits = 5
#     )
#   )
# )
# 
# test_that(
#   "calculate_daily_returns() correctly handles Apple's 7-to-1 split in 2014.",
#   expect_identical(
#     calculate_daily_returns(
#       sample_historical_data["AAPL"],
#       date_range_xts = "2014-06-09"
#     )[[1]] %>%
#       zoo::coredata() %>%
#       round(digits = 5),
#     cbind(
#       "ln_rtn"    = 1.58746908251272,
#       "log2_rtn"  = 2.29023377290565,
#       "log10_rtn" = 0.68942906272729,
#       "pct_diff"  = 1.60013631364528,
#       "multiple"  = 1.01600136313645
#     ) %>%
#       round(digits = 5)
#   )
# )
# 
# test_that(
#   paste0(
#     "calculate_daily_returns() correctly handles General Dynamics' returns for",
#     " March & April of 2006, during which there was a split and a dividend."
#   ),
#   expect_identical(
#     calculate_daily_returns(
#       sample_historical_data["GD"],
#       date_range_xts = "2006-03/2006-04"
#     )[[1]] %>%
#       zoo::coredata() %>%
#       round(digits = 5),
#     cbind(
#       "ln_rtn"    = c(0.960730757764365, 1.57835082063451, 1.07768987962062, -0.502001211096756, -0.322923920993547, 0.126143189227483, -0.007879289292192, -0.481814446562756, 0.843620724522282, 0.563690524137649, 0.85510471291652, 0.146962164362956, 0.984471879676485, 0.381942256384332, -0.81145664579879, 0.34529096266783, 0.229533383101698, 0.320464183916124, -1.21863933878954, -1.31958757161065, 0.793840265035779, -0.37278701140143, -0.436681916634063, 0.140570112955817, 1.5794691933366, -0.55461550268771, 0.879838970516577, -0.199984683219276, 0.368890673471572, -0.538421422251128, -1.39797244082688, -0.062588016438352, 0.561886916107725, 3.36680613839253, 4.3581164192238, -1.56820405588054, -0.660746842666139, 0.95301652317069, -0.321543685397435, -0.410738438678859, 0.366811356927038, -3.97363703932843),
#       "log2_rtn"  = c(1.38604149985614, 2.27707890171243, 1.55477784494489, -0.724234657769543, -0.46588073940181, 0.181986153540408, -0.011367411587575, -0.695111312684749, 1.21708743565945, 0.813233523769487, 1.23365532876544, 0.212021585724746, 1.4202926987039, 0.551026199191617, -1.17068447879031, 0.498149559504655, 0.331146673519286, 0.46233208891832, -1.75812493070387, -1.9037624455814, 1.1452694136251, -0.537817972656661, -0.62999883557385, 0.202799804858558, 2.2786923724636, -0.800141035327698, 1.26933931954512, -0.2885169107342, 0.532196745247627, -0.776777915790085, -2.01684790768038, -0.090295420934688, 0.810631467409008, 4.85727451949342, 6.28743294563094, -2.26244021452081, -0.953256193197479, 1.3749122118636, -0.463889480352041, -0.592570308584466, 0.529196925580389, -5.73274645093183),
#       "log10_rtn" = c(0.417240066691793, 0.685469051909036, 0.468034767922213, -0.21801635588807, -0.140244076962059, 0.054783291011174, -0.003421931860918, -0.209249355443474, 0.36637982547925, 0.244807684134133, 0.371367258269109, 0.063824857031391, 0.427550704932419, 0.165875414353392, -0.352411143574136, 0.149957959737701, 0.099685081693653, 0.139175826722401, -0.529248340266524, -0.573089600738619, 0.344760446617654, -0.161899341976846, -0.189648546741109, 0.061048824377228, 0.685954755002264, -0.24086645239527, 0.382109209858787, -0.086852244387302, 0.160207183914278, -0.233833452622166, -0.607131716903934, -0.027181630172447, 0.24402438711922, 1.46218532754187, 1.89270591236085, -0.681062367967217, -0.2869587077049, 0.413889817175653, -0.139644648258941, -0.178381437423786, 0.159304148212857, -1.72572863926671),
#       "pct_diff"  = c(0.965360590573527, 1.59087256950023, 1.08351787409049, -0.500743290822314, -0.32240308248801, 0.126222783212371, -0.007878978884346, -0.480655582696399, 0.847189231987344, 0.565282248567156, 0.858771176516515, 0.147070206672351, 0.989333745555721, 0.382672585335997, -0.808173223543762, 0.345887778631826, 0.229797012638833, 0.320978219335122, -1.21124400091415, -1.31091918568785, 0.796999531176734, -0.372093023255804, -0.43572984749457, 0.140668959049695, 1.59200874044017, -0.553080350284219, 0.883720930232546, -0.199784847087747, 0.369571912534661, -0.53697453206506, -1.38824618232299, -0.06256843422493, 0.56346846141806, 3.42412451361869, 4.45447705041384, -1.55597176199395, -0.658568710668817, 0.957572186210975, -0.32102728731942, -0.409896062069981, 0.367484933117734, -3.89572349150556),
#       "multiple"  = c(1.00965360590574, 1.015908725695, 1.01083517874091, 0.994992567091777, 0.99677596917512, 1.00126222783212, 0.999921210211157, 0.995193444173036, 1.00847189231987, 1.00565282248567, 1.00858771176517, 1.00147070206672, 1.00989333745556, 1.00382672585336, 0.991918267764562, 1.00345887778632, 1.00229797012639, 1.00320978219335, 0.987887559990858, 0.986890808143122, 1.00796999531177, 0.996279069767442, 0.995642701525054, 1.0014066895905, 1.0159200874044, 0.994469196497158, 1.00883720930233, 0.998002151529123, 1.00369571912535, 0.994630254679349, 0.98611753817677, 0.999374315657751, 1.00563468461418, 1.03424124513619, 1.04454477050414, 0.984440282380061, 0.993414312893312, 1.00957572186211, 0.996789727126806, 0.9959010393793, 1.00367484933118, 0.961042765084944)
#     ) %>%
#       round(digits = 5)
#   )
# )
