<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate Market Portfolio — calculate_market_portfolio • FinancieR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cyborg/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Calculate Market Portfolio — calculate_market_portfolio"><meta property="og:description" content="Calculate the Sharpe-optimal market portfolio available for a set of assets
given the expected returns, volatilities, and correlations of returns for
each asset."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FinancieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/FinancieR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gothic-hedge-society/FinancieR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Market Portfolio</h1>
    <small class="dont-index">Source: <a href="https://github.com/gothic-hedge-society/FinancieR/blob/HEAD/R/calculate_market_portfolio.R"><code>R/calculate_market_portfolio.R</code></a></small>
    <div class="hidden name"><code>calculate_market_portfolio.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate the Sharpe-optimal market portfolio available for a set of assets
given the expected returns, volatilities, and correlations of returns for
each asset.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">calculate_market_portfolio</span><span class="op">(</span><span class="va">exp_rtn</span>, <span class="va">exp_vol</span>, <span class="va">exp_cor</span>, rfr <span class="op">=</span> <span class="fl">2.7397e-05</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>exp_rtn</dt>
<dd><p>Named numeric vector for which each element is the return
expected for the next period for the asset specified by the element's name.</p></dd>
<dt>exp_vol</dt>
<dd><p>Named numeric vector for which each element is the volatility
expected for the asset specified by the element's name.</p></dd>
<dt>exp_cor</dt>
<dd><p>Named numeric matrix specifying the expected covariance of
returns for each asset pair.</p></dd>
<dt>rfr</dt>
<dd><p>The risk-free rate (in decimal form; i.e., to specify a rate of
"3%" use "0.03", <em>not</em> "3") that <strong>YOU</strong> can earn on cash with
reasonable liquidity constraints that <strong>YOU</strong> can tolerate. For big
banks and in economic textbooks, this rate is usually the current rate on
3-month T-bills (or even higher). That might be just fine for you if you
plan on rebalancing once a year. For a trader running a strategy that can't
tolerate cash being tied up for 3 months at a time, the <em>rfr</em> should
be set to whatever interest rate your brokerage is giving you on cash in
your trading account. Used in calculation of the
<a href="https://www.investopedia.com/articles/07/sharpe_ratio.asp" class="external-link">Sharpe
Ratio</a>. Defaults to <strong>0.0027397</strong>% daily return (about 1% annually).
If you specify a different value for <em>rfr</em>, <strong>make sure its time
basis matches the one used for you other inputs</strong>, (i.e., if <em>exp_rtn</em>
contains monthly returns, use monthly risk-free rate)!</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list describing the market portfolio (MP) having four elements:</p><dl><dt><code>sharpe</code>, numeric:</dt>
<dd><p>Sharpe Ratio of MP</p></dd>

<dt><code>weights</code>, named numeric vector:</dt>
<dd><p>The values of
<code>weights</code> range from 0 to 1 and denote the fraction of the total
MP value allocated to the asset whose identifier is that value's name.</p></dd>

<dt><code>ex_return</code>, numeric:</dt>
<dd><p>The return that is expected (i.e.,
predicted/forecast) for the MP over the next time interval.</p></dd>

<dt><code>ex_volatility</code>:</dt>
<dd><p>The volatility that is expected (i.e.,
predicted/forecast) for the MP over the next time interval.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>All arguments which are percentages (<em>exp_rtn</em>, <em>exp_vol</em>, and
<em>rfr</em>) must be supplied in decimal form; i.e., to specify "12%", use
0.12, not 12.</p>
<p>It should go without saying, but make sure that every asset is represented
in the three inputs: names of <em>exp_rtn</em>, <em>exp_vol</em>, and the row &amp;
colnames of <em>exp_cor</em>.</p>
<p>This function works by finding the Sharpe-optimum equal-weighted portfolio
that can be created using the assets passed in. Using that portfolio as a
starting point, the function finds the assets A and B such that
reallocating ("selling") a small amount (<em>step</em>) of A into asset B
("buying") results in a portfolio whose Sharpe is greater than all other
possible assets A and B. The portfolio variable is updated.</p>
<p>This process is repeated with smaller and smaller <em>step</em> sizes. When
it is not possible to reallocate <em>step</em> amount of any asset A into any
other asset B so as to create a portfolio having a better Sharpe, the
Market Portfolio has been reached and the function returns the value.</p>
<p>This function answers the question: "What is the the optimum fractional,
real-valued weight of each asset in the Sharpe-optimal MP?" Because the
Sharpe ratio and the optimum weights are real numbers, this operation can
be computed with arbitrary precision, to infinte decimal places.
<em>calculate_market_portfolio</em>() was written to be clearly understood
and run reasonably fast, and testing indicates that the weights are
reliable to within +/- 1% (i.e., "0.18" to "0.20" for a reported weight of
"0.19") of the optimal value. As such, weights reported by <em>weights
mode</em> should be considered somewhat approximate.</p>
    </div>
    <div id="the-cost-of-shorting">
    <h2>The Cost of Shorting</h2>
    

<p>You would only short an asset if the return you expect for buying that asset
is negative. You may think that the expected return for shorting an asset is
simply the return you expect for longing the asset times -1. In reality, the
return you'll get from a short sale will be a fraction of the asset times -1
because your broker charges fees on short position in exchange for providing
the shorting service. In addition, the capital gains from short selling may
taxed at a different rate than those realized on your long positions.</p>
<p>The key additional costs of shorting are:</p>
<dl><dt>Dividends</dt>
<dd><p>You don't earn dividends on a short position. In fact, it's the
opposite: if you're short a stock on a dividend's ex-date, then you must
actually <em>pay</em> the dividend to the owner of the stock.
<em><a href="calculate_historical_returns.html">calculate_historical_returns</a></em>() takes this into account
itself when shorting is included.</p></dd>

<dt>Short Fees</dt>
<dd><p>Your brokerage will charge a fee on a short position for every day the
position is open. This fee is based on the availability of assets for
shorting, and varies from asset to asset and through time. Usually the
fee is calculated on each trading day and debited from the trading
account on at the beginning of each month.</p></dd>

<dt>Taxes</dt>
<dd><p>Capital gains taxes on your short sales can often be taxed at a higher
rate than what you might expect for long sales. If <strong>uncovered</strong>,
the short position will always be taxed as a short-term capital gain
because the holding period is considered by the IRS to begin on the day
when the short position was closed out (bought to cover). If
<strong>covered</strong>, then the holding period is considered to be the
holding period of the <em>substantially different securities</em> that can
be converted to the stock itself. Taxes must be taken into account in
the <em>exp_rtn</em> parameter as passed to
<em>calculate_market_portfolio</em>.</p><div class="sourceCode"><pre><code> Taxes will depend on your situation: whether you expect a short-term or
 long-term investment, your income bracket, whether or not you're an
 institution, etc. You must figure that out for yourself, and you might
 find that, once everything is taken into account, it's just not worth it
 to short assets in a lot of situations. Stay smart!
</code></pre></div>

</dd>


</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Let's pick an example date for which to create an MP:</span></span>
<span class="r-in"><span class="va">mp_date</span> <span class="op">&lt;-</span> <span class="st">"2018-01-09"</span></span>
<span class="r-in"><span class="co"># Feel free to change this date to any other date for which you have data.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Use calculate_historical_returns() to get the daily returns observed for the 365 days</span></span>
<span class="r-in"><span class="co"># ending on mp_date:</span></span>
<span class="r-in"><span class="va">historical_rtn</span> <span class="op">&lt;-</span> <span class="fu"><a href="calculate_historical_returns.html">calculate_historical_returns</a></span><span class="op">(</span></span>
<span class="r-in">  assets         <span class="op">=</span> <span class="va">stock_data</span>,</span>
<span class="r-in">  date_range_xts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span class="r-in">    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">mp_date</span><span class="op">)</span> <span class="op">-</span> <span class="fl">365</span>,</span>
<span class="r-in">    <span class="st">"/"</span>,</span>
<span class="r-in">    <span class="va">mp_date</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">ℹ</span> No data available for <span style="font-weight: bold;">LIN</span> during time range <span style="font-weight: bold;">2017-01-09/2018-01-09</span>.</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Note that we get an error message about LIN: that's because PX merged Linde</span></span>
<span class="r-in"><span class="co"># Plc during the time period we selected, and the system is alerting you that</span></span>
<span class="r-in"><span class="co"># data for the newly merged company, which trades under "LIN", is not available.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># We'll assume that the return we expect over the next year is the annualized </span></span>
<span class="r-in"><span class="co"># GMMR of the daily rates of return in historical_rtn:</span></span>
<span class="r-in"><span class="va">exp_rtn</span> <span class="op">&lt;-</span> <span class="fu"><a href="gmrr.html">gmrr</a></span><span class="op">(</span><span class="va">historical_rtn</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Assume that the volatilities we expect for the next year are the annualized</span></span>
<span class="r-in"><span class="co"># daily vols we observed during the previous year:</span></span>
<span class="r-in"><span class="va">exp_vol</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">historical_rtn</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/as_vector.html" class="external-link">as_vector</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Assume that the correlations of returns of each asset pair that we expect</span></span>
<span class="r-in"><span class="co"># for the next year will be the same as the previous year:</span></span>
<span class="r-in"><span class="va">exp_cor</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">historical_rtn</span>, use <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Calculate the market portfolio:</span></span>
<span class="r-in"><span class="va">mp_by_wt</span> <span class="op">&lt;-</span> <span class="fu">calculate_market_portfolio</span><span class="op">(</span><span class="va">exp_rtn</span>, <span class="va">exp_vol</span>, <span class="va">exp_cor</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in library("foreach"):</span> there is no package called ‘foreach’</span>
<span class="r-in"><span class="va">mp_by_wt</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'mp_by_wt' not found</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jake Vestal.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

