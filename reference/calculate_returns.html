<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate Returns — calculate_returns • FinancieR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cyborg/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  <script src="../extra.js"></script>

<meta property="og:title" content="Calculate Returns — calculate_returns" />
<meta property="og:description" content="Calculate period-over-period historical returns for a list of assets, taking
into account splits and dividends." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FinancieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/FinancieR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/gothic-hedge-society/FinancieR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Returns</h1>
    <small class="dont-index">Source: <a href='https://github.com/gothic-hedge-society/FinancieR/blob/master/R/calculate_returns.R'><code>R/calculate_returns.R</code></a></small>
    <div class="hidden name"><code>calculate_returns.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate period-over-period historical returns for a list of assets, taking
into account splits and dividends.</p>
    </div>

    <pre class="usage"><span class='fu'>calculate_returns</span>(
  <span class='no'>assets</span>,
  <span class='kw'>date_range_xts</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>buy_at</span> <span class='kw'>=</span> <span class='st'>"Close"</span>,
  <span class='kw'>sell_at</span> <span class='kw'>=</span> <span class='st'>"Close"</span>,
  <span class='kw'>returns_method</span> <span class='kw'>=</span> <span class='st'>"ln"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>assets</th>
      <td><p>a list of sub-lists named and corresponding to a given
asset, for example, "AAPL". Each sublist contains split, dividend, and
aggregated prices data as xts objects. An example of an object that may be
passed as <em>asset_data</em> is <a href='stock_data.html'>stock_data</a>.</p></td>
    </tr>
    <tr>
      <th>date_range_xts</th>
      <td><p>A string that specifies the date range for which
<em>calculate_daily_returns</em>() will calculate returns. Use xts subsetting
notation to specify the date range; see examples in <a href='https://rdrr.io/pkg/xts/man/xts.html'>xts</a>. If
missing or NULL, then the full date range of OHLCV prices is used.</p></td>
    </tr>
    <tr>
      <th>buy_at</th>
      <td><p>Character: Specifies the 'initial price' to be used for
calculating returns. Must be one of "open", "high", "low", "close", or
"price", defaults to "Close". Not case sensitive.</p></td>
    </tr>
    <tr>
      <th>sell_at</th>
      <td><p>Character: Specifies the 'final price' to be used for
calculating returns. Must be One of "open", "high", "low", "close", or
"price", defaults to "Close". Not case sensitive.</p></td>
    </tr>
    <tr>
      <th>returns_method</th>
      <td><p>Character vector specifying how the returns should be
calculated, defaults to <strong><em>"ln</em></strong>. Choices are:</p><ul>
<li><p><strong>"ln"</strong>: Log return; <em>ln(sell_price / buy_price)</em> where
<em>ln()</em> denotes the natural logarithm (base <em>e</em>).</p></li>
<li><p><strong>"log2"</strong>: Log return; <em>log(sell_price / buy_price)</em>
where <em>log()</em> denotes the logarithm to base <em>2</em>.</p></li>
<li><p><strong>"log10"</strong>: Log return; <em>log(sell_price / buy_price)</em>
where <em>log()</em> denotes the logarithm to base <em>10</em>.</p></li>
<li><p><strong>"pct_diff"</strong>: Percent difference;
<em>(sell_price - buy_price)/buy_price</em>. NOT multiplied by 100.</p></li>
<li><p><strong>"multiple"</strong>: Price multiple; <em>sell_price / buy_price</em>.</p></li>
</ul></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An xts object. Each element is the return observed on the date given
by the xts' index with respect to the previous period (taking into
account any splits and dividends that may have occurred) for the asset
specified by the element's column name.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Calculate daily natural log returns of Apple (AAPL) and AT&amp;T (T) for 2014, a</span>
<span class='co'># year in which Apple had a major stock split.</span>
<span class='no'>aapl_att_returns</span> <span class='kw'>&lt;-</span> <span class='fu'>calculate_returns</span>(
  <span class='kw'>assets</span>         <span class='kw'>=</span> <span class='no'>stock_data</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"AAPL"</span>, <span class='st'>"T"</span>)],
  <span class='kw'>date_range_xts</span> <span class='kw'>=</span> <span class='st'>"2014"</span>
)

<span class='co'># Print the first 10 rows:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>aapl_att_returns</span>, <span class='fl'>10</span>)</div><div class='output co'>#&gt;                    AAPL             T
#&gt; 2014-01-03 -0.022210746 -0.0043010819
#&gt; 2014-01-06  0.005438253  0.0045871640
#&gt; 2014-01-07 -0.007181981 -0.0002860821
#&gt; 2014-01-08  0.006317525 -0.0071787817
#&gt; 2014-01-09 -0.012854131 -0.0206557949
#&gt; 2014-01-10 -0.006693129  0.0023823716
#&gt; 2014-01-13  0.005221455 -0.0095637310
#&gt; 2014-01-14  0.019702704  0.0053908486
#&gt; 2014-01-15  0.019878344  0.0092166551
#&gt; 2014-01-16 -0.005595502  0.0050184607</div><div class='input'>
<span class='co'># Let's check this result in a few key places. </span>

<span class='co'># 1) Normal trading day</span>
<span class='co'>#      Because we didn't specify otherwise, calculate_returns() will use its</span>
<span class='co'>#      default behavior and will calculate period-over-period natural-log</span>
<span class='co'>#      returns using Close prices. Let's pick Monday, 21 July 2014, which was a</span>
<span class='co'>#      normal trading day (no dividend, no split) for AT&amp;T. The previous trading</span>
<span class='co'>#      day was Friday, 18 Jul 2014:</span>
<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>prices</span>[<span class='st'>"2014-07-18/2014-07-21"</span>]</div><div class='output co'>#&gt;             Open  High   Low Close    TWAP    VWAP   Volume PreviousCloseDate
#&gt; 2014-07-18 36.18 36.19 36.00 36.17 36.1052 36.1115 16132950             16268
#&gt; 2014-07-21 36.07 36.16 35.88 35.96 36.0222 36.0169 20917407             16269
#&gt;            PreviousClose
#&gt; 2014-07-18         36.03
#&gt; 2014-07-21         36.17</div><div class='input'>
<span class='co'>#      The natural log return using Close prices (calculate_returns() default)</span>
<span class='co'>#      as calculated by hand should be:</span>
<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(
  <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>prices</span>$<span class='no'>Close</span>[<span class='st'>"2014-07-21"</span>]) /
    <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>prices</span>$<span class='no'>Close</span>[<span class='st'>"2014-07-18"</span>])
)</div><div class='output co'>#&gt; [1] -0.005822836</div><div class='input'>
<span class='co'>#      This return was realized on 2014-07-21, so it should appear at that date</span>
<span class='co'>#      index in the results returned by calculate_returns():</span>
<span class='no'>aapl_att_returns</span>[<span class='st'>"2014-07-21"</span>, <span class='st'>"T"</span>]</div><div class='output co'>#&gt;                       T
#&gt; 2014-07-21 -0.005822836</div><div class='input'>
<span class='co'># 2) AT&amp;T's dividend</span>
<span class='co'>#      AT&amp;T paid several dividends in 2014:</span>
<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>dividends</span>[<span class='st'>"2014"</span>]</div><div class='output co'>#&gt;            DividendAmount RecordDate   DeclaredDate Type              
#&gt; 2014-01-08 "0.46000"      "2014-01-10" "2013-12-13" "OrdinaryDividend"
#&gt; 2014-04-08 "0.46000"      "2014-04-10" "2014-03-28" "OrdinaryDividend"
#&gt; 2014-07-08 "0.46000"      "2014-07-10" "2014-06-27" "OrdinaryDividend"
#&gt; 2014-10-08 "0.46000"      "2014-10-10" "2014-09-26" "OrdinaryDividend"
#&gt;            PaymentFrequency
#&gt; 2014-01-08 "Quarterly"     
#&gt; 2014-04-08 "Quarterly"     
#&gt; 2014-07-08 "Quarterly"     
#&gt; 2014-10-08 "Quarterly"     </div><div class='input'>
<span class='co'>#     If you had bought a share of AT&amp;T stock on 07 July 2014 and sold it at the</span>
<span class='co'>#     Close price the next day after the dividend went ex-div, you would have</span>
<span class='co'>#     collected the closing price from the sale plus the dividend amount, </span>
<span class='co'>#     meaning that your total earned return would have been:</span>
<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(
  (
    <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>prices</span>$<span class='no'>Close</span>[<span class='st'>"2014-07-08"</span>]) +
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>dividends</span>$<span class='no'>DividendAmount</span>[<span class='st'>"2014-07-08"</span>])
  ) / <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>T</span>$<span class='no'>prices</span>$<span class='no'>Close</span>[<span class='st'>"2014-07-07"</span>])
)</div><div class='output co'>#&gt; [1] 0</div><div class='input'>
<span class='co'>#      This return was realized on 2014-07-08, so it should appear at that date</span>
<span class='co'>#      index in the results returned by calculate_returns():</span>
<span class='no'>aapl_att_returns</span>[<span class='st'>"2014-07-08"</span>, <span class='st'>"T"</span>]</div><div class='output co'>#&gt;            T
#&gt; 2014-07-08 0</div><div class='input'><span class='co'># --&gt; In this case, the stock closed at the same price as the previous day once</span>
<span class='co'>#     the dividend was taken into account, so return = 0.</span>

<span class='co'># 3) AAPL's split</span>
<span class='co'>#      Apple underwent a major split on a Monday in June of 2014:</span>
<span class='no'>stock_data</span>$<span class='no'>AAPL</span>$<span class='no'>splits</span></div><div class='output co'>#&gt;            Denominator Numerator
#&gt; 2014-06-09           7         1</div><div class='input'>
<span class='co'>#     If you had bought a share of AAPL at Close price on Friday, you would have</span>
<span class='co'>#     woken up on Monday morning with 7 shares... each one of which worth about</span>
<span class='co'>#     1/7th what they were worth previously. If you sold those shares at Close</span>
<span class='co'>#     price on Monday, your total return would be:</span>
<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(
  (
    <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>AAPL</span>$<span class='no'>prices</span>$<span class='no'>Close</span>[<span class='st'>"2014-06-09"</span>]) *
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>AAPL</span>$<span class='no'>splits</span>$<span class='no'>Denominator</span>[<span class='st'>"2014-06-09"</span>])
  ) / <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>stock_data</span>$<span class='no'>AAPL</span>$<span class='no'>prices</span>$<span class='no'>Close</span>[<span class='st'>"2014-06-06"</span>])
)</div><div class='output co'>#&gt; [1] 0.01587469</div><div class='input'>
<span class='co'>#      This return was realized on 2014-06-09, so it should appear at that date</span>
<span class='co'>#      index in the results returned by calculate_returns():</span>
<span class='no'>aapl_att_returns</span>[<span class='st'>"2014-06-09"</span>, <span class='st'>"AAPL"</span>]</div><div class='output co'>#&gt;                  AAPL
#&gt; 2014-06-09 0.01587469</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jake Vestal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


